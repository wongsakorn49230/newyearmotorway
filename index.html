<!DOCTYPE html>
<html lang="th">
<head>
  <link href="https://fonts.googleapis.com/css2?family=Roboto&display=swap" rel="stylesheet">




  <meta charset="UTF-8">
  <title>‡∏™‡∏∏‡πà‡∏°‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•</title>
  <style>

body {
  font-family: 'Roboto', sans-serif;
  background-color: #f4f6f9;
  text-align: center;
  padding: 40px;
  color: #003366; /* ‡∏Å‡∏£‡∏°‡∏ó‡πà‡∏≤ */
}

h1 {
  color: #005bac;
  font-weight: 600;
}

    input {
      padding: 5px;
      font-size: 1em;
      margin: 10px;
    }

    button {
  padding: 10px 20px;
  font-size: 1.1em;
  border-radius: 8px;
  border: none;
  background-color: #005bac;
  color: white;
  cursor: pointer;
  transition: background-color 0.3s ease;
}

  button:hover {
    background-color: #004a94;
  }

    .slots-row {
      display: flex;
      justify-content: center;
      gap: 10px;
      margin: 20px 0;
      flex-wrap: wrap;
    }

    .slot {
    width: 320px;
    height: 60px; /* ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏π‡∏á‡πÄ‡∏•‡πá‡∏Å‡∏ô‡πâ‡∏≠‡∏¢ */
    overflow: hidden;
    border: 2px solid #007bff; /* ‡∏Å‡∏£‡∏≠‡∏ö‡∏™‡∏µ‡∏ô‡πâ‡∏≥‡πÄ‡∏á‡∏¥‡∏ô */
    border-radius: 10px;
    background-color: #ffffff; /* ‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á‡∏Ç‡∏≤‡∏ß */
    box-shadow: 0 0 8px rgba(0, 91, 172, 0.2);
    position: relative;
  }

  .slot-inner {
    transition: transform 2s cubic-bezier(0.1, 1, 0.68, 1);
  }

    .slot-item {
      height: 50px;
      display: flex;
      justify-content: center;
      align-items: center;
      font-size: 1.3em;
      color: #004a94;
    }

    @keyframes spinUp {
      0% { top: 0; }
      100% { top: -100%; }
    }

    .removed-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
    gap: 10px;
    justify-content: center;
    text-align: left;
    margin-top: 10px;
  }

  .removed-col {
    background: #ffffff;
    padding: 10px;
    border: 1px solid #cdd7e0;
    border-radius: 10px;
    box-shadow: 0 2px 6px rgba(0,0,0,0.05);
  }

  .removed-col p {
    color: #003366;
    margin: 0;
    padding: 2px 0;
  }
  </style>
</head>

<body>

  <h1>üé∞ ‡∏™‡∏∏‡πà‡∏°‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•‡∏à‡∏≤‡∏Å‡∏ú‡∏π‡πâ‡∏£‡πà‡∏ß‡∏°‡∏™‡∏±‡∏á‡∏™‡∏£‡∏£‡∏Ñ‡πå ‡∏õ‡∏µ‡πÉ‡∏´‡∏°‡πà‡πÑ‡∏ó‡∏¢ MOTORWAY üé∞</h1>
  <label>
    ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ñ‡∏ô‡∏ó‡∏µ‡πà‡∏£‡∏±‡∏ö‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏• :
    <input type="number" id="countInput" value="1" min="1">
  </label>
  <br>
  <div id="remainingCount" style="margin: 15px 0; font-size: 1.2em; font-weight: bold;"></div>

  <br>
  <button onclick="spinSlot()">üé≤ ‡∏™‡∏∏‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠ !</button>

  <div id="slotsContainer" class="slots-row"></div>


  <hr style="width: 60%; margin: 30px auto;">
  <h3>üìã ‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏• :</h3>
  <div id="winnerDisplay"></div>
  <div class="result" id="removedList"></div>

  <br><br>
<button onclick="downloadWinners()">üì• ‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÇ‡∏ä‡∏Ñ‡∏î‡∏µ</button>


  <br><br><br>
  <button onclick="resetRemovedNames()">üîÑ ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>

  <script>
    // üëâ ‡πÉ‡∏™‡πà‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ
    const apiKey = "AIzaSyAEhTJt5D0RD-K0Hi5o0av9QylRR2VZYiQ";
    const sheetId = "1WM5YGsFModXF1Sj9ePqvGboNeSW-ywJvAuEMfobR3QU";
    const sheetName = "Form Responses 1";

    const slotDisplay = document.getElementById("slotsContainer");
    const winnerDisplay = document.getElementById("winnerDisplay");
    const countInput = document.getElementById("countInput");
    const removedList = document.getElementById("removedList");

    let names = [];
    let removedNames = [];











    function updateRemainingCount() {
  const count = names.length;
  document.getElementById("remainingCount").textContent = `üî¢ ‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏™‡∏∏‡πà‡∏°‡∏≠‡∏µ‡∏Å ${count} ‡∏Ñ‡∏ô`;
}





async function resetRemovedNames() {
  if (!confirm("‡∏Ñ‡∏∏‡∏ì‡πÅ‡∏ô‡πà‡πÉ‡∏à‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà‡∏ß‡πà‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î?")) return;

  removedNames = [];
  localStorage.removeItem("removedNames");
  renderRemovedList();

  await fetchNames();            // üëà ‡πÇ‡∏´‡∏•‡∏î‡∏ä‡∏∑‡πà‡∏≠‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á
  updateRemainingCount();        // üëà ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡πÉ‡∏´‡∏°‡πà

  alert("‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ñ‡∏π‡∏Å‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡πÅ‡∏•‡πâ‡∏ß!");
}





window.onload = async () => {
  // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏°‡∏µ‡∏ä‡∏∑‡πà‡∏≠‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏•‡∏ö (removedNames) ‡πÉ‡∏ô localStorage ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
  const storedRemovedNames = localStorage.getItem("removedNames");
  if (storedRemovedNames) {
    removedNames = JSON.parse(storedRemovedNames);
    renderRemovedList(); // ‡πÅ‡∏™‡∏î‡∏á‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏™‡∏∏‡πà‡∏°‡πÑ‡∏õ‡πÅ‡∏•‡πâ‡∏ß
  }

  // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏°‡∏µ‡∏ä‡∏∑‡πà‡∏≠‡πÉ‡∏ô pool (names) ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
  if (names.length === 0) {
    await fetchNames(); // ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ä‡∏∑‡πà‡∏≠‡πÉ‡∏ô pool ‡πÉ‡∏´‡πâ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å Google Sheets
  }
  updateRemainingCount();        // üëà ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡πÉ‡∏´‡∏°‡πà
  
};


function downloadWinners() {
  if (removedNames.length === 0) {
    alert("‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÇ‡∏ä‡∏Ñ‡∏î‡∏µ‡πÉ‡∏´‡πâ‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î!");
    return;
  }

  const lines = removedNames.map(([_, name], index) => `${index + 1}. ${name}`);
  const content = "‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÇ‡∏ä‡∏Ñ‡∏î‡∏µ:\n\n" + lines.join("\n");

  const blob = new Blob([content], { type: "text/plain;charset=utf-8" });
  const url = URL.createObjectURL(blob);

  const a = document.createElement("a");
  a.href = url;
  a.download = "‡∏ú‡∏π‡πâ‡πÇ‡∏ä‡∏Ñ‡∏î‡∏µ.txt";
  document.body.appendChild(a);
  a.click();
  document.body.removeChild(a);
  URL.revokeObjectURL(url);
}



function renderWinnerList(winners) {
      const columns = [];
      for (let i = 0; i < winners.length; i += 10) {
        const group = winners.slice(i, i + 10);
        const colHtml = group.map((name, j) => `<p>${i + j + 1}. ${name}</p>`).join("");
        columns.push(`<div class="removed-col">${colHtml}</div>`);
      }
      winnerDisplay.innerHTML = `
        <h3>üéâ ‡∏ú‡∏π‡πâ‡πÇ‡∏ä‡∏Ñ‡∏î‡∏µ ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô ${winners.length} ‡∏Ñ‡∏ô :</h3>
        <div class="removed-grid">${columns.join("")}</div>
      `;
    }


    function renderRemovedList() {
      const allNames = removedNames.map(([_, name]) => name);
      const columns = [];
      for (let i = 0; i < allNames.length; i += 10) {
        const group = allNames.slice(i, i + 10);
        const colHtml = group.map((name, j) => `<p>${i + j + 1}. ${name}</p>`).join("");
        columns.push(`<div class="removed-col">${colHtml}</div>`);
      }
      removedList.innerHTML = `<div class="removed-grid">${columns.join("")}</div>`;
    }



    async function fetchNames() {
  if (names.length > 0) return;  // ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡πÉ‡∏ô names ‡πÅ‡∏•‡πâ‡∏ß ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÇ‡∏´‡∏•‡∏î‡πÉ‡∏´‡∏°‡πà

  const url = `https://sheets.googleapis.com/v4/spreadsheets/${sheetId}/values/${sheetName}!A:D?key=${apiKey}`;
  try {
    const response = await fetch(url);
    const data = await response.json();

    const rows = data.values.slice(1); // ‡∏Ç‡πâ‡∏≤‡∏°‡∏´‡∏±‡∏ß‡∏ï‡∏≤‡∏£‡∏≤‡∏á

    const uniqueMap = new Map();

    for (const row of rows) {
      const name = row[0]?.trim(); // ‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå A: ‡∏ä‡∏∑‡πà‡∏≠
      const key = row[3]?.trim();  // ‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå D: ‡∏£‡∏´‡∏±‡∏™ Primary Key

      if (key && name && !removedNames.includes(key)) {
        uniqueMap.set(key, name); // ‡πÄ‡∏Å‡πá‡∏ö‡πÄ‡∏õ‡πá‡∏ô Map <key, name>
      }
    }

    names = Array.from(uniqueMap.entries()); // [ [key, name], ... ]
  } catch (error) {
    console.error("Error fetching data:", error);
    alert("‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö API key ‡πÅ‡∏•‡∏∞ Sheet ID");
  }
}

function getRandomUniqueItems(array, count) {
  const shuffled = [...array].sort(() => 0.5 - Math.random());
  return shuffled.slice(0, count);
}


    function updateSlotDisplay(count) {
      slotDisplay.innerHTML = "";
      for (let i = 0; i < count; i++) {
        const slot = document.createElement("div");
        slot.className = "slot";
        slot.id = `slot${i}`;

        const inner = document.createElement("div");
        inner.className = "slot-inner";
        inner.id = `slotInner${i}`;
        slot.appendChild(inner);

        slotDisplay.appendChild(slot);
      }
    }






    async function spinSlot() {
  const count = parseInt(countInput.value) || 1;
  // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤ pool ‡∏Ç‡∏≠‡∏á‡∏ä‡∏∑‡πà‡∏≠‡∏´‡∏°‡∏î‡πÅ‡∏•‡πâ‡∏ß‡∏´‡∏£‡∏∑‡∏≠‡∏¢‡∏±‡∏á
  if (names.length === 0) {
    alert("‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ä‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏™‡∏∏‡πà‡∏°‡πÅ‡∏•‡πâ‡∏ß!");
    return; // ‡∏´‡∏¢‡∏∏‡∏î‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏´‡∏≤‡∏Å‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ä‡∏∑‡πà‡∏≠
  }


  if (count > names.length) {
    alert("‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏°‡∏≤‡∏Å‡∏Å‡∏ß‡πà‡∏≤‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ä‡∏∑‡πà‡∏≠‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏≠‡∏¢‡∏π‡πà!");
    return;
  }

  updateSlotDisplay(count);

  const winners = getRandomUniqueItems(names, count);
  const allRollingNames = [];

  for (let i = 0; i < count; i++) {
    const inner = document.getElementById(`slotInner${i}`);
    inner.innerHTML = "";

    const [winnerKey, winnerName] = winners[i];
    const otherNames = names.filter(([k]) => k !== winnerKey).map(([_, n]) => n);
    const randomFakes = getRandomUniqueItems(otherNames, Math.min(19, otherNames.length));
    const rollingNames = [...randomFakes, winnerName];

    allRollingNames.push({ inner, rollingNames });

    for (const name of rollingNames) {
      const div = document.createElement("div");
      div.className = "slot-item";
      div.textContent = name;
      inner.appendChild(div);
    }
  }

  setTimeout(() => {
    for (let i = 0; i < count; i++) {
      const { inner, rollingNames } = allRollingNames[i];
      const offset = (rollingNames.length - 1) * 50;
      inner.style.transform = `translateY(-${offset}px)`;
    }

    removedNames = removedNames.concat(winners); // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ú‡∏π‡πâ‡πÇ‡∏ä‡∏Ñ‡∏î‡∏µ‡πÑ‡∏õ‡∏¢‡∏±‡∏á removedNames
    names = names.filter(name => !winners.includes(name)); // ‡∏•‡∏ö‡∏ú‡∏π‡πâ‡πÇ‡∏ä‡∏Ñ‡∏î‡∏µ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å names
    localStorage.setItem("removedNames", JSON.stringify(removedNames)); // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏•‡∏á‡πÉ‡∏ô localStorage

    setTimeout(() => {
      renderRemovedList();
      updateRemainingCount();
    }, 2500);
  }, 2500);
}


  </script>
</body>
</html>